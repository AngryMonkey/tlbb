--洛阳NPC
--货商
--漕运循环任务

--脚本号
x311009_g_scriptId = 311009

Step = 600

x311009_g_Monger_Region = {}
x311009_g_Monger_Region[1] = {
	Scene_Id = 3,
	[10]={x=43,y=58},
	[1]={x=47,y=66},
	[2]={x=49,y=73},
	[3]={x=52,y=78},
	[4]={x=65,y=84},
	[5]={x=74,y=88},
	[6]={x=78,y=97},
	[7]={x=85,y=95},
	[8]={x=93,y=101},
	[9]={x=61,y=73},
	}
	
x311009_g_Monger_Region[2] = {
	Scene_Id = 3,
	[10]={x=280,y=252},
	[1]={x=283,y=261},
	[2]={x=276,y=265},
	[3]={x=280,y=276},
	[4]={x=273,y=280},
	[5]={x=265,y=276},
	[6]={x=256,y=276},
	[7]={x=262,y=267},
	[8]={x=254,y=266},
	[9]={x=244,y=268},
	}
	
x311009_g_Monger_Region[3] = {
	Scene_Id = 4,
	[10]={x=218,y=268},
	[1]={x=208,y=271},
	[2]={x=197,y=266},
	[3]={x=190,y=260},
	[4]={x=180,y=260},
	[5]={x=174,y=253},
	[6]={x=167,y=251},
	[7]={x=168,y=261},
	[8]={x=157,y=259},
	[9]={x=160,y=251},
	}
	
x311009_g_Monger_Region[4] = {
	Scene_Id = 4,
	[10]={x=109,y=48},
	[1]={x=112,y=54},
	[2]={x=114,y=38},
	[3]={x=96,y=36},
	[4]={x=125,y=55},
	[5]={x=126,y=62},
	[6]={x=118,y=65},
	[7]={x=128,y=72},
	[8]={x=114,y=74},
	[9]={x=125,y=79},
	}
x311009_g_Monger_Region[5] = {
	Scene_Id = 5,
	[10]={x=274,y=45},
	[1]={x=268,y=48},
	[2]={x=263,y=52},
	[3]={x=255,y=56},
	[4]={x=234,y=60},
	[5]={x=224,y=58},
	[6]={x=207,y=55},
	[7]={x=212,y=74},
	[8]={x=198,y=60},
	[9]={x=246,y=51},
	}
x311009_g_Monger_Region[6] = {
	Scene_Id = 5,
	[10]={x=41,y=277},
	[1]={x=36,y=270},
	[2]={x=43,y=264},
	[3]={x=51,y=271},
	[4]={x=55,y=259},
	[5]={x=49,y=246},
	[6]={x=51,y=236},
	[7]={x=62,y=243},
	[8]={x=69,y=261},
	[9]={x=77,y=247},
	}
x311009_g_Monger_Region[7] = {
	Scene_Id = 6,
	[10]={x=268,y=78},
	[1]={x=260,y=80},
	[2]={x=259,y=85},
	[3]={x=265,y=87},
	[4]={x=254,y=91},
	[5]={x=249,y=95},
	[6]={x=245,y=98},
	[7]={x=239,y=101},
	[8]={x=231,y=99},
	[9]={x=223,y=91},
	}
x311009_g_Monger_Region[8] = {
	Scene_Id = 6,
	[10]={x=49,y=168},
	[1]={x=52,y=155},
	[2]={x=61,y=170},
	[3]={x=72,y=168},
	[4]={x=70,y=180},
	[5]={x=76,y=185},
	[6]={x=91,y=181},
	[7]={x=100,y=173},
	[8]={x=107,y=164},
	[9]={x=120,y=165},
	}
x311009_g_Monger_Region[9] = {
	Scene_Id = 7,
	[10]={x=98,y=45},
	[1]={x=108,y=50},
	[2]={x=107,y=57},
	[3]={x=94,y=55},
	[4]={x=94,y=64},
	[5]={x=87,y=44},
	[6]={x=57,y=71},
	[7]={x=50,y=47},
	[8]={x=44,y=54},
	[9]={x=46,y=66},
	}
x311009_g_Monger_Region[10] = {
	Scene_Id = 7,
	[10]={x=42,y=269},
	[1]={x=57,y=274},
	[2]={x=41,y=252},
	[3]={x=52,y=238},
	[4]={x=52,y=221},
	[5]={x=40,y=221},
	[6]={x=53,y=209},
	[7]={x=68,y=211},
	[8]={x=53,y=197},
	[9]={x=50,y=187},
	}
x311009_g_Monger_Region[11] = {
	Scene_Id = 8,
	[10]={x=271,y=148},
	[1]={x=250,y=155},
	[2]={x=233,y=145},
	[3]={x=229,y=156},
	[4]={x=245,y=167},
	[5]={x=205,y=139},
	[6]={x=212,y=152},
	[7]={x=202,y=120},
	[8]={x=182,y=121},
	[9]={x=163,y=109},
	}
x311009_g_Monger_Region[12] = {
	Scene_Id = 8,
	[10]={x=223,y=256},
	[1]={x=209,y=254},
	[2]={x=214,y=243},
	[3]={x=198,y=244},
	[4]={x=200,y=233},
	[5]={x=183,y=231},
	[6]={x=181,y=216},
	[7]={x=166,y=233},
	[8]={x=138,y=242},
	[9]={x=125,y=218},
	}
--**********************************
--事件交互入口
--**********************************
function x311009_OnDefaultEvent( sceneId, selfId,targetId )
	if	PRE_TIME == nil then
		PRE_TIME = LuaFnGetCurrentTime()
	else
		DUA_TIME = LuaFnGetCurrentTime() - PRE_TIME
		if	DUA_TIME >= Step then
			EVENT_NOW = random(1,4)
			PRE_TIME = PRE_TIME + floor(DUA_TIME / Step) *Step;
		end
	end
	if	EVENT_NOW == nil then
		EVENT_NOW = random(1,4)
	end
	
	EVENT_NOW = 1
	
	local World_Time = LuaFnGetCurrentWorldTime();
--	PrintStr("World_Time="..World_Time.." world scene_id="..x311009_g_Monger_Region[World_Time+1].Scene_Id.." sceneId="..sceneId)

	if x311009_g_Monger_Region[World_Time+1].Scene_Id ~= sceneId then
		BeginEvent(sceneId)
			AddText(sceneId,"  不好意思，我现在不能为你提供服务。")
		EndEvent(sceneId)
		DispatchEventList(sceneId,selfId,targetId)
		return
	end

	BeginEvent(sceneId)
	AddText(sceneId,"  你好，我是这里的漕货经销商。")

	if IsHaveMission(sceneId,selfId,4021) > 0 then
	
		if	EVENT_NOW == 1 then
			AddNumText(sceneId,x311009_g_scriptId,"进入黑市",7,255)
		elseif	EVENT_NOW == 2 then
			AddNumText(sceneId,x311009_g_scriptId,"帮忙哄抬物价",6,EVENT_NOW)
		elseif	EVENT_NOW == 3 then
			AddNumText(sceneId,x311009_g_scriptId,"帮忙打压市场",6,EVENT_NOW)
		end

	end
	EndEvent(sceneId)
	DispatchEventList(sceneId,selfId,targetId)
end

--**********************************
--事件列表选中一项
--**********************************
function x311009_OnEventRequest( sceneId, selfId, targetId, eventId )
	local NumText = GetNumText()

	if	NumText == 255	then
		CallScriptFunction(311010, "OnEnumerate",sceneId, selfId, targetId)
	else
		CallScriptFunction(311010, "OnHandle_QuestUI",sceneId, selfId, targetId, NumText)
	end

end

function x311009_OnCharacterTimer( sceneId, selfId, dataId, uTime )

	local World_Time = LuaFnGetCurrentWorldTime();
	local Coordinate = x311009_g_Monger_Region[World_Time+1];
	
	if not Coordinate then
		return
	end
	
	if Coordinate.Scene_Id == sceneId then
		TRAFFICKER_CLICK_TIMES = 0
	end
	
	local rrr = random(10)
--	PrintNum(rrr)
--	PrintStr("World_Time="..World_Time)
	SetPos( sceneId, selfId, Coordinate[rrr].x,Coordinate[rrr].y)
--	PrintStr("我飞到"..Coordinate[rrr].x.." "..Coordinate[rrr].y.."去了！在"..sceneId.."场景")
end

