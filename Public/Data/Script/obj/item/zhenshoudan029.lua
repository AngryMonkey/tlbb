--ÕäÊŞµ°

--½Å±¾ºÅ
x300027_g_scriptId = 300027

x300027_g_petList = {};
x300027_g_petList[30309002] = {type=1, dataId=3009, level=1}	--ÕäÊŞµ°£ºÍÃ×Ó
x300027_g_petList[30309003] = {type=1, dataId=3019, level=1}	--ÕäÊŞµ°£ºÑà×Ó
x300027_g_petList[30309004] = {type=1, dataId=3029, level=1}	--ÕäÊŞµ°£ºÎÚ¹ê
x300027_g_petList[30309005] = {type=1, dataId=3039, level=1}	--ÕäÊŞµ°£º¹·
x300027_g_petList[30309006] = {type=1, dataId=3049, level=1}	--ÕäÊŞµ°£º´Ìâ¬
x300027_g_petList[30309007] = {type=1, dataId=3059, level=1}	--ÕäÊŞµ°£ººï×Ó
x300027_g_petList[30309008] = {type=1, dataId=3069, level=1}	--ÕäÊŞµ°£ºËÉÊó
x300027_g_petList[30309009] = {type=1, dataId=3079, level=1}	--ÕäÊŞµ°£ºä½ĞÜ
x300027_g_petList[30309010] = {type=1, dataId=3089, level=1}	--ÕäÊŞµ°£ºğĞğÄ
x300027_g_petList[30309011] = {type=1, dataId=3099, level=1}	--ÕäÊŞµ°£ºòáòæ
x300027_g_petList[30309012] = {type=1, dataId=3109, level=1}	--ÕäÊŞµ°£ºòùòğ
x300027_g_petList[30309013] = {type=1, dataId=3119, level=1}	--ÕäÊŞµ°£º´óó«òë
x300027_g_petList[30309014] = {type=1, dataId=3129, level=1}	--ÕäÊŞµ°£ºöùÓã
x300027_g_petList[30309015] = {type=1, dataId=3139, level=1}	--ÕäÊŞµ°£ºÃ¨Í·Ó¥
x300027_g_petList[30309016] = {type=1, dataId=3149, level=1}	--ÕäÊŞµ°£ºâµ
x300027_g_petList[30309017] = {type=1, dataId=3159, level=1}	--ÕäÊŞµ°£ºÀÏ»¢
x300027_g_petList[30309018] = {type=1, dataId=3169, level=1}	--ÕäÊŞµ°£ºÒ°Öí
x300027_g_petList[30309019] = {type=1, dataId=3179, level=1}	--ÕäÊŞµ°£º±ù²Ï
x300027_g_petList[30309020] = {type=1, dataId=3189, level=1}	--ÕäÊŞµ°£ºÓ¥
x300027_g_petList[30309021] = {type=1, dataId=3199, level=1}	--ÕäÊŞµ°£ºÍÒÄñ
x300027_g_petList[30309022] = {type=1, dataId=3209, level=1}	--ÕäÊŞµ°£º±ª×Ó
x300027_g_petList[30309023] = {type=1, dataId=3219, level=1}	--ÕäÊŞµ°£º±±¼«ĞÜ
x300027_g_petList[30309024] = {type=1, dataId=3229, level=1}	--ÕäÊŞµ°£º¿×È¸
x300027_g_petList[30309025] = {type=1, dataId=3239, level=1}	--ÕäÊŞµ°£º½£³İ»¢
x300027_g_petList[30309026] = {type=1, dataId=3249, level=1}	--ÕäÊŞµ°£º´óĞÉĞÉ
x300027_g_petList[30309027] = {type=1, dataId=3259, level=1}	--ÕäÊŞµ°£ºÏ¬Å£
x300027_g_petList[30309028] = {type=1, dataId=3269, level=1}	--ÕäÊŞµ°£ºÑ©õõ
x300027_g_petList[30309029] = {type=1, dataId=3279, level=1}	--ÕäÊŞµ°£º½£Áú
x300027_g_petList[30309030] = {type=1, dataId=3289, level=1}	--ÕäÊŞµ°£º²µÂí
x300027_g_petList[30309031] = {type=1, dataId=3299, level=1}	--ÕäÊŞµ°£º»ÆÄñ
x300027_g_petList[30309032] = {type=1, dataId=3309, level=1}	--ÕäÊŞµ°£ºÄêÊŞ
x300027_g_petList[30309033] = {type=1, dataId=3319, level=1}	--ÕäÊŞµ°£ºÁú¹ê
x300027_g_petList[30309034] = {type=1, dataId=3329, level=1}	--ÕäÊŞµ°£ºÓ¢ÕĞ
x300027_g_petList[30309035] = {type=1, dataId=3339, level=1}	--ÕäÊŞµ°£º÷è÷ë
x300027_g_petList[30309036] = {type=1, dataId=3349, level=1}	--ÕäÊŞµ°£ºòÔÁú
x300027_g_petList[30309037] = {type=1, dataId=3359, level=1}	--ÕäÊŞµ°£º²ñÃ¨
x300027_g_petList[30309038] = {type=1, dataId=3369, level=1}	--ÕäÊŞµ°£º¼¦
x300027_g_petList[30309039] = {type=1, dataId=3379, level=1}	--ÕäÊŞµ°£ºÑ¼×Ó
x300027_g_petList[30309040] = {type=1, dataId=3389, level=1}	--ÕäÊŞµ°£ºÉ½Ñò
x300027_g_petList[30309041] = {type=1, dataId=3399, level=1}	--ÕäÊŞµ°£ºÃ«Â¿
x300027_g_petList[30309042] = {type=1, dataId=3409, level=1}	--ÕäÊŞµ°£º¶ì
x300027_g_petList[30309043] = {type=1, dataId=3419, level=1}	--ÕäÊŞµ°£º°ÔÍõÁú
x300027_g_petList[30309044] = {type=1, dataId=3429, level=1}	--ÕäÊŞµ°£ºÆó¶ì
x300027_g_petList[30309045] = {type=1, dataId=3439, level=1}	--ÕäÊŞµ°£º´üÊó
x300027_g_petList[30309046] = {type=1, dataId=3449, level=1}	--ÕäÊŞµ°£ºÑ¼×ìÊŞ
x300027_g_petList[30309047] = {type=1, dataId=3459, level=1}	--ÕäÊŞµ°£ºÖí
x300027_g_petList[30309048] = {type=1, dataId=3469, level=1}	--ÕäÊŞµ°£ºÇàÍÜ
x300027_g_petList[30309049] = {type=1, dataId=3479, level=1}	--ÕäÊŞµ°£ºĞ¡Ïó
x300027_g_petList[30309050] = {type=1, dataId=3489, level=1}	--ÕäÊŞµ°£ºÑ©ºü
x300027_g_petList[30309051] = {type=1, dataId=3499, level=1}	--ÕäÊŞµ°£ºÀÇ
x300027_g_petList[30505108] = {type=0, dataId=3459, level=1}	--ÕäÊŞµ°£ºÖí
x300027_g_petList[30505109] = {type=1, dataId=6069, level=1}	--ÕäÊŞµ°£ºÄ«¾µÃ¨
x300027_g_petList[30505110] = {type=1, dataId=6079, level=1}	--ÕäÊŞµ°£ºÁ÷ĞĞÃ¨
x300027_g_petList[30505111] = {type=1, dataId=6089, level=1}	--ÕäÊŞµ°£ºÊ±ÉĞÃ¨
x300027_g_petList[30505112] = {type=1, dataId=6099, level=1}	--ÕäÊŞµ°£ºÅ¼ÏñÃ¨
x300027_g_petList[30505113] = {type=1, dataId=6109, level=1}	--ÕäÊŞµ°£º¹Ú¾üÃ¨
x300027_g_petList[30505121] = {type=1, dataId=6569, level=1}	--Æó¶ìµ°
x300027_g_petList[30505126] = {type=1, dataId=6649, level=1}	--ÓñÍÃÁåîõ
x300027_g_petList[30505127] = {type=1, dataId=6659, level=1}	--ğ©ÔÂÓñÍÃÁåîõ
x300027_g_petList[30505128] = {type=1, dataId=6669, level=1}	--ó¸¹¬ÓñÍÃÁåîõ
x300027_g_petList[30505129] = {type=1, dataId=6679, level=1}	--æÏ¶ğÓñÍÃÁåîõ

--**********************************
-- ·µ»Ø1£º¼¼ÄÜÀàËÆµÄÎïÆ·£¬¿ÉÒÔ¼ÌĞøÀàËÆ¼¼ÄÜµÄÖ´ĞĞ£»·µ»Ø0£ºÖ´ĞĞ OnDefaultEvent¡£
--**********************************
function x300027_IsSkillLikeScript( sceneId, selfId )
	return 1
end

--**********************************
-- ·µ»Ø1£ºÒÑ¾­È¡Ïû¶ÔÓ¦Ğ§¹û£¬²»ÔÙÖ´ĞĞºóĞø²Ù×÷£»·µ»Ø0£ºÃ»ÓĞ¼ì²âµ½Ïà¹ØĞ§¹û£¬¼ÌĞøÖ´ĞĞ¡£
--**********************************
function x300027_CancelImpacts( sceneId, selfId )
	return 0
end

--**********************************
-- Ìõ¼ş¼ì²âÈë¿Ú£º·µ»Ø1£ºÌõ¼ş¼ì²âÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÌõ¼ş¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x300027_OnConditionCheck( sceneId, selfId )
	-- Ğ£ÑéÊ¹ÓÃµÄÎïÆ·
	if LuaFnVerifyUsedItem( sceneId, selfId ) ~= 1 then
		return 0
	end

	local checkCreatePet = TryCreatePet(sceneId, selfId, 1);
	if not checkCreatePet or checkCreatePet ~= 1 then
		x300027_NotifyFailTips(sceneId, selfId, "Các hÕ không th¬ mang thêm Tr³® thú.");
		return 0;
	end

	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300027_g_petList[itemTblIndex];
	if not petItem then
		x300027_NotifyFailTips(sceneId, selfId, "Chßa m· ğÕo cø, không th¬ sØ døng.");
		return 0;
	end
	
	local takeLevel = GetPetTakeLevel(petItem.dataId);
	local humanLevel = LuaFnGetLevel(sceneId, selfId);
	if not takeLevel or not humanLevel or takeLevel > humanLevel then
		x300027_NotifyFailTips(sceneId, selfId, "ĞÆng c¤p cÄ¬ các hÕ không th¬ th¤p h½n so vçµ ğÆng c¤p Tr³® thú mang theo");
		return 0;
	end

	return 1
end

--**********************************
--ÏûºÄ¼ì²â¼°´¦ÀíÈë¿Ú£¬¸ºÔğÏûºÄµÄ¼ì²âºÍÖ´ĞĞ£º
--·µ»Ø1£ºÏûºÄ´¦ÀíÍ¨¹ı£¬¿ÉÒÔ¼ÌĞøÖ´ĞĞ£»·µ»Ø0£ºÏûºÄ¼ì²âÊ§°Ü£¬ÖĞ¶ÏºóĞøÖ´ĞĞ¡£
--**********************************
function x300027_OnDeplete( sceneId, selfId )
	if LuaFnDepletingUsedItem( sceneId, selfId ) > 0 then
		return 1
	end

	return 0
end

--**********************************
--Ö»»áÖ´ĞĞÒ»´ÎÈë¿Ú£º
--¾ÛÆøºÍË²·¢¼¼ÄÜ»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¾ÛÆø½áÊø²¢ÇÒ¸÷ÖÖÌõ¼ş¶¼Âú×ãµÄÊ±ºò£©£¬¶øÒıµ¼
--¼¼ÄÜÒ²»áÔÚÏûºÄÍê³Éºóµ÷ÓÃÕâ¸ö½Ó¿Ú£¨¼¼ÄÜµÄÒ»¿ªÊ¼£¬ÏûºÄ³É¹¦Ö´ĞĞÖ®ºó£©¡£
--·µ»Ø1£º´¦Àí³É¹¦£»·µ»Ø0£º´¦ÀíÊ§°Ü¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜÉúĞ§Ò»´ÎµÄÈë¿Ú
--**********************************
function x300027_OnActivateOnce( sceneId, selfId )
	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300027_g_petList[itemTblIndex];
	if not petItem then
		x300027_NotifyFailTips(sceneId, selfId, "Chßa m· ğÕo cø, không th¬ sØ døng.");
		return 0;
	end

	if petItem.type == 1 then
		local ret = CallScriptFunction( 800105, "CreateRMBPetToHuman", sceneId, selfId, petItem.dataId, petItem.level);
		if ret and ret == 1 then
			local petName = GetPetName(petItem.dataId);
			if petName then
				x800105_ShowTips(sceneId, selfId, "Chúl m×ng các hÕ thành công thu ğßşc"..petName.."!");
			end
			--local itemName = GetItemName(sceneId, itemTblIndex);
			--if petName and itemName then
			--	LuaFnSendSystemMail(sceneId, GetName(sceneId, selfId), "Í¨¹ıÊ¹ÓÃ"..itemName.."£¬Äú³É¹¦µÄ»ñµÃÁËÒ»Ö»"..petName.."£¬Çë´ò¿ªÕäÊŞ½çÃæ£¨¿ÉÒÔ°´alt+X¿ìËÙ´ò¿ªÕäÊŞ½çÃæ£©½øĞĞ²é¿´¡£");
			--else
			--	LuaFnSendSystemMail(sceneId, GetName(sceneId, selfId), "Äú³É¹¦µÄ»ñµÃÁËÒ»Ö»ÕäÊŞ£¬Çë´ò¿ªÕäÊŞ½çÃæ£¨¿ÉÒÔ°´alt+X¿ìËÙ´ò¿ªÕäÊŞ½çÃæ£©½øĞĞ²é¿´¡£");
			--end
			LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 18, 0);
		end
	else
	    local ret, petGUID_H, petGUID_L = LuaFnCreatePetToHuman(sceneId, selfId, petItem.dataId, petItem.level, 0);
	    if ret and ret == 1 then
			local petName = GetPetName(petItem.dataId);
			if petName then
				x800105_ShowTips(sceneId, selfId, "Chúl m×ng các hÕ thành công thu ğßşc"..petName.."!");
			end
			LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 18, 0);
		end
	end
	return 1
end

--**********************************
--Òıµ¼ĞÄÌø´¦ÀíÈë¿Ú£º
--Òıµ¼¼¼ÄÜ»áÔÚÃ¿´ÎĞÄÌø½áÊøÊ±µ÷ÓÃÕâ¸ö½Ó¿Ú¡£
--·µ»Ø£º1¼ÌĞøÏÂ´ÎĞÄÌø£»0£ºÖĞ¶ÏÒıµ¼¡£
--×¢£ºÕâÀïÊÇ¼¼ÄÜĞÄÌøÊ±ÉúĞ§µÄÈë¿Ú
--**********************************
function x300027_OnActivateEachTick( sceneId, selfId )
	return 1
end

--**********************************
-- ĞÑÄ¿Ê§°ÜÌáÊ¾
--**********************************
function x300027_NotifyFailTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end
