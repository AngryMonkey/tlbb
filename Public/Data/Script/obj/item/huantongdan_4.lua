--珍兽还童丹[变化到目标珍兽类型]

--脚本号
x300100_g_scriptId = 300100

--rulerId
--0	= 普通规则
--1 = 普通RMB规则
--2 = 炫耀RMB规则
x300100_g_itemList = {}

---------龙猫
x300100_g_itemList[30309150] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309150].petIds[5] = 7649;
x300100_g_itemList[30309150].petIds[45] = 7659;

x300100_g_itemList[30309163] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309163].petIds[5] = 7649;
x300100_g_itemList[30309163].petIds[45] = 7659;
x300100_g_itemList[30309163].petIds[55] = 7669;
x300100_g_itemList[30309163].petIds[65] = 7679;
x300100_g_itemList[30309163].petIds[75] = 7689;
x300100_g_itemList[30309163].petIds[85] = 7699;
--x300100_g_itemList[30309163].petIds[95] = 7709;

---------熊猫
x300100_g_itemList[30309151] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309151].petIds[5] = 7789;
x300100_g_itemList[30309151].petIds[45] = 7799;

x300100_g_itemList[30309164] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309164].petIds[5] = 7789;
x300100_g_itemList[30309164].petIds[45] = 7799;
x300100_g_itemList[30309164].petIds[55] = 7809;
x300100_g_itemList[30309164].petIds[65] = 7819;
x300100_g_itemList[30309164].petIds[75] = 7829;
x300100_g_itemList[30309164].petIds[85] = 7839;
--x300100_g_itemList[30309164].petIds[95] = 7849;

---------蝴蝶
x300100_g_itemList[30309152] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309152].petIds[5] = 7929;
x300100_g_itemList[30309152].petIds[45] = 7939;

x300100_g_itemList[30309165] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309165].petIds[5] = 7929;
x300100_g_itemList[30309165].petIds[45] = 7939;
x300100_g_itemList[30309165].petIds[55] = 7949;
x300100_g_itemList[30309165].petIds[65] = 7959;
x300100_g_itemList[30309165].petIds[75] = 7969;
x300100_g_itemList[30309165].petIds[85] = 7979;
--x300100_g_itemList[30309165].petIds[95] = 7989;

---------蜗牛
x300100_g_itemList[30309153] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309153].petIds[5] = 7999;
x300100_g_itemList[30309153].petIds[45] = 8009;

x300100_g_itemList[30309166] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309166].petIds[5] = 7999;
x300100_g_itemList[30309166].petIds[45] = 8009;
x300100_g_itemList[30309166].petIds[55] = 8019;
x300100_g_itemList[30309166].petIds[65] = 8029;
x300100_g_itemList[30309166].petIds[75] = 8039;
x300100_g_itemList[30309166].petIds[85] = 8049;
--x300100_g_itemList[30309166].petIds[95] = 8059;

---------蝎子
x300100_g_itemList[30309154] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309154].petIds[5] = 8069;
x300100_g_itemList[30309154].petIds[45] = 8079;

x300100_g_itemList[30309167] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309167].petIds[5] = 8069;
x300100_g_itemList[30309167].petIds[45] = 8079;
x300100_g_itemList[30309167].petIds[55] = 8089;
x300100_g_itemList[30309167].petIds[65] = 8099;
x300100_g_itemList[30309167].petIds[75] = 8109;
x300100_g_itemList[30309167].petIds[85] = 8119;
--x300100_g_itemList[30309167].petIds[95] = 8129;

---------螃蟹
x300100_g_itemList[30309155] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309155].petIds[5] = 7859;
x300100_g_itemList[30309155].petIds[45] = 7869;

x300100_g_itemList[30309168] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309168].petIds[5] = 7859;
x300100_g_itemList[30309168].petIds[45] = 7869;
x300100_g_itemList[30309168].petIds[55] = 7879;
x300100_g_itemList[30309168].petIds[65] = 7889;
x300100_g_itemList[30309168].petIds[75] = 7899;
x300100_g_itemList[30309168].petIds[85] = 7909;
--x300100_g_itemList[30309168].petIds[95] = 7919;

---------犀鸟
x300100_g_itemList[30309156] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309156].petIds[5] = 7719;
x300100_g_itemList[30309156].petIds[45] = 7729;

x300100_g_itemList[30309169] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309169].petIds[5] = 7719;
x300100_g_itemList[30309169].petIds[45] = 7729;
x300100_g_itemList[30309169].petIds[55] = 7739;
x300100_g_itemList[30309169].petIds[65] = 7749;
x300100_g_itemList[30309169].petIds[75] = 7759;
x300100_g_itemList[30309169].petIds[85] = 7769;
--x300100_g_itemList[30309169].petIds[95] = 7779;

---------鸭嘴兽
x300100_g_itemList[30309157] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309157].petIds[5] = 7509;
x300100_g_itemList[30309157].petIds[45] = 7519;

x300100_g_itemList[30309170] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309170].petIds[5] = 7509;
x300100_g_itemList[30309170].petIds[45] = 7519;
x300100_g_itemList[30309170].petIds[55] = 7529;
x300100_g_itemList[30309170].petIds[65] = 7539;
x300100_g_itemList[30309170].petIds[75] = 7549;
x300100_g_itemList[30309170].petIds[85] = 7559;
--x300100_g_itemList[30309170].petIds[95] = 7569;

---------雪狐
x300100_g_itemList[30309158] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309158].petIds[5] = 7579;
x300100_g_itemList[30309158].petIds[45] = 7589;

x300100_g_itemList[30309171] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309171].petIds[5] = 7579;
x300100_g_itemList[30309171].petIds[45] = 7589;
x300100_g_itemList[30309171].petIds[55] = 7599;
x300100_g_itemList[30309171].petIds[65] = 7609;
x300100_g_itemList[30309171].petIds[75] = 7619;
x300100_g_itemList[30309171].petIds[85] = 7629;
--x300100_g_itemList[30309171].petIds[95] = 7639;

---------小貘
x300100_g_itemList[30309159] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309159].petIds[5] = 8139;
x300100_g_itemList[30309159].petIds[45] = 8149;

x300100_g_itemList[30309172] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309172].petIds[5] = 8139;
x300100_g_itemList[30309172].petIds[45] = 8149;
x300100_g_itemList[30309172].petIds[55] = 8159;
x300100_g_itemList[30309172].petIds[65] = 8169;
x300100_g_itemList[30309172].petIds[75] = 8179;
x300100_g_itemList[30309172].petIds[85] = 8189;
--x300100_g_itemList[30309172].petIds[95] = 8199;

---------甲虫
x300100_g_itemList[30309160] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309160].petIds[5] = 8209;
x300100_g_itemList[30309160].petIds[45] = 8219;

x300100_g_itemList[30309173] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309173].petIds[5] = 8209;
x300100_g_itemList[30309173].petIds[45] = 8219;
x300100_g_itemList[30309173].petIds[55] = 8229;
x300100_g_itemList[30309173].petIds[65] = 8239;
x300100_g_itemList[30309173].petIds[75] = 8249;
x300100_g_itemList[30309173].petIds[85] = 8259;
--x300100_g_itemList[30309173].petIds[95] = 8269;

---------当扈
x300100_g_itemList[30309161] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309161].petIds[5] = 8279;
x300100_g_itemList[30309161].petIds[45] = 8289;

x300100_g_itemList[30309174] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309174].petIds[5] = 8279;
x300100_g_itemList[30309174].petIds[45] = 8289;
x300100_g_itemList[30309174].petIds[55] = 8299;
x300100_g_itemList[30309174].petIds[65] = 8309;
x300100_g_itemList[30309174].petIds[75] = 8319;
x300100_g_itemList[30309174].petIds[85] = 8329;
--x300100_g_itemList[30309174].petIds[95] = 8339;

---------海盗鼠
x300100_g_itemList[30309162] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309162].petIds[5] = 8349;
x300100_g_itemList[30309162].petIds[45] = 8359;

x300100_g_itemList[30309175] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309175].petIds[5] = 8349;
x300100_g_itemList[30309175].petIds[45] = 8359;
x300100_g_itemList[30309175].petIds[55] = 8369;
x300100_g_itemList[30309175].petIds[65] = 8379;
x300100_g_itemList[30309175].petIds[75] = 8389;
x300100_g_itemList[30309175].petIds[85] = 8399;
--x300100_g_itemList[30309175].petIds[95] = 8409;

---------宝箱童子
x300100_g_itemList[30309176] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309176].petIds[5] = 8419;
x300100_g_itemList[30309176].petIds[45] = 8429;

x300100_g_itemList[30309177] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309177].petIds[5] = 8419;
x300100_g_itemList[30309177].petIds[45] = 8429;
x300100_g_itemList[30309177].petIds[55] = 8439;
x300100_g_itemList[30309177].petIds[65] = 8449;
x300100_g_itemList[30309177].petIds[75] = 8459;
x300100_g_itemList[30309177].petIds[85] = 8469;
--x300100_g_itemList[30309177].petIds[95] = 8479;

---------树袋熊
x300100_g_itemList[30309178] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309178].petIds[5] = 8489;
x300100_g_itemList[30309178].petIds[45] = 8499;

x300100_g_itemList[30309179] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309179].petIds[5] = 8489;
x300100_g_itemList[30309179].petIds[45] = 8499;
x300100_g_itemList[30309179].petIds[55] = 8509;
x300100_g_itemList[30309179].petIds[65] = 8519;
x300100_g_itemList[30309179].petIds[75] = 8529;
x300100_g_itemList[30309179].petIds[85] = 8539;
--x300100_g_itemList[30309179].petIds[95] = 8549;

---------欢乐猪
x300100_g_itemList[30309180] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309180].petIds[5] = 8569;
x300100_g_itemList[30309180].petIds[45] = 8579;

x300100_g_itemList[30309181] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309181].petIds[5] = 8569;
x300100_g_itemList[30309181].petIds[45] = 8579;
x300100_g_itemList[30309181].petIds[55] = 8589;
x300100_g_itemList[30309181].petIds[65] = 8599;
x300100_g_itemList[30309181].petIds[75] = 8609;
x300100_g_itemList[30309181].petIds[85] = 8619;
--x300100_g_itemList[30309181].petIds[95] = 8629;

---------唐装鼠
x300100_g_itemList[30309182] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309182].petIds[5] = 8749;
x300100_g_itemList[30309182].petIds[45] = 8759;

x300100_g_itemList[30309183] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309183].petIds[5] = 8749;
x300100_g_itemList[30309183].petIds[45] = 8759;
x300100_g_itemList[30309183].petIds[55] = 8769;
x300100_g_itemList[30309183].petIds[65] = 8779;
x300100_g_itemList[30309183].petIds[75] = 8789;
x300100_g_itemList[30309183].petIds[85] = 8799;
--x300100_g_itemList[30309183].petIds[95] = 8809;

---------年兽
x300100_g_itemList[30309184] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309184].petIds[5] = 8819;
x300100_g_itemList[30309184].petIds[45] = 8829;

x300100_g_itemList[30309185] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309185].petIds[5] = 8819;
x300100_g_itemList[30309185].petIds[45] = 8829;
x300100_g_itemList[30309185].petIds[55] = 8839;
x300100_g_itemList[30309185].petIds[65] = 8849;
x300100_g_itemList[30309185].petIds[75] = 8859;
x300100_g_itemList[30309185].petIds[85] = 8869;
--x300100_g_itemList[30309185].petIds[95] = 8879;

---------鸳鸯
x300100_g_itemList[30309186] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309186].petIds[5] = 8889;
x300100_g_itemList[30309186].petIds[45] = 8899;

x300100_g_itemList[30309187] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309187].petIds[5] = 8889;
x300100_g_itemList[30309187].petIds[45] = 8899;
x300100_g_itemList[30309187].petIds[55] = 8909;
x300100_g_itemList[30309187].petIds[65] = 8919;
x300100_g_itemList[30309187].petIds[75] = 8929;
x300100_g_itemList[30309187].petIds[85] = 8939;
--x300100_g_itemList[30309187].petIds[95] = 8949;

---------比翼鸟
x300100_g_itemList[30309188] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309188].petIds[5] = 22219;
x300100_g_itemList[30309188].petIds[45] = 22229;

x300100_g_itemList[30309189] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309189].petIds[5] = 22219;
x300100_g_itemList[30309189].petIds[45] = 22229;
x300100_g_itemList[30309189].petIds[55] = 22239;
x300100_g_itemList[30309189].petIds[65] = 22249;
x300100_g_itemList[30309189].petIds[75] = 22259;
x300100_g_itemList[30309189].petIds[85] = 22269;
--x300100_g_itemList[30309189].petIds[95] = 22279;

---------呆呆牛
x300100_g_itemList[30309190] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309190].petIds[5] = 22289;
x300100_g_itemList[30309190].petIds[45] = 22299;

x300100_g_itemList[30309191] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309191].petIds[5] = 22289;
x300100_g_itemList[30309191].petIds[45] = 22299;
x300100_g_itemList[30309191].petIds[55] = 22309;
x300100_g_itemList[30309191].petIds[65] = 22319;
x300100_g_itemList[30309191].petIds[75] = 22329;
x300100_g_itemList[30309191].petIds[85] = 22339;
----------Go仔
x300100_g_itemList[30309192] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 45, petIds = {} }
x300100_g_itemList[30309192].petIds[5] = 22499;
x300100_g_itemList[30309192].petIds[45] = 22509;

x300100_g_itemList[30309193] = { rulerId = 2, minPetLevel = 1, maxPetLevel = 85, petIds = {} }
x300100_g_itemList[30309193].petIds[5] = 22499;
x300100_g_itemList[30309193].petIds[45] = 22509;
x300100_g_itemList[30309193].petIds[55] = 22519;
x300100_g_itemList[30309193].petIds[65] = 22529;
x300100_g_itemList[30309193].petIds[75] = 22539;
x300100_g_itemList[30309193].petIds[85] = 22549;

--x300100_g_itemList[30309191].petIds[95] = 22349;
x300100_g_ItemName = 0
--**********************************
-- 返回1：技能类似的物品，可以继续类似技能的执行；返回0：执行 OnDefaultEvent。
--**********************************
function x300100_IsSkillLikeScript( sceneId, selfId )
	return 1
end

--**********************************
-- 返回1：已经取消对应效果，不再执行后续操作；返回0：没有检测到相关效果，继续执行。
--**********************************
function x300100_CancelImpacts( sceneId, selfId )
	return 0
end

--**********************************
-- 条件检测入口：返回1：条件检测通过，可以继续执行；返回0：条件检测失败，中断后续执行。
--**********************************
function x300100_OnConditionCheck( sceneId, selfId )
	-- 校验使用的物品
	if LuaFnVerifyUsedItem( sceneId, selfId ) ~= 1 then
		return 0
	end
	
	local check = x300100_CanOperate(sceneId, selfId);
	if not check or check ~= 1 then
		return 0;
	end
	return 1
end

--**********************************
--消耗检测及处理入口，负责消耗的检测和执行：
--返回1：消耗处理通过，可以继续执行；返回0：消耗检测失败，中断后续执行。
--**********************************
function x300100_OnDeplete( sceneId, selfId )
	
	local bagpos = LuaFnGetBagIndexOfUsedItem( sceneId, selfId )
	x300100_g_ItemName = GetBagItemTransfer( sceneId, selfId, bagpos )									
	if LuaFnDepletingUsedItem( sceneId, selfId ) > 0 then
		return 1
	end

	return 0
end

--**********************************
--只会执行一次入口：
--聚气和瞬发技能会在消耗完成后调用这个接口（聚气结束并且各种条件都满足的时候），而引导
--技能也会在消耗完成后调用这个接口（技能的一开始，消耗成功执行之后）。
--返回1：处理成功；返回0：处理失败。
--注：这里是技能生效一次的入口
--**********************************
function x300100_OnActivateOnce( sceneId, selfId )
	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300100_g_itemList[itemTblIndex];
	if not petItem then
		x300100_NotifyFailTips(sceneId, selfId, "未开放道具，无法使用。");
		return 0;
	end

	local petGUID_H = LuaFnGetHighSectionOfTargetPetGuid( sceneId, selfId );
	local petGUID_L = LuaFnGetLowSectionOfTargetPetGuid( sceneId, selfId );
	if not petGUID_H or not petGUID_L then
		x300100_NotifyFailTips(sceneId, selfId, "未到找指定珍兽。");
		return 0;
	end
	
	local check = x300100_CanOperate(sceneId, selfId);
	if not check or check ~= 1 then
		return 0;
	end
	
	local curPetTemplateId = LuaFnGetPetDataIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	local curPetTakeLevel = GetPetTakeLevel(curPetTemplateId);
	local needMoney = LuaFnGetPetHuanTongCost(sceneId, curPetTakeLevel);
	needMoney = needMoney / 100;
	local costMoneyRet = LuaFnCostMoneyWithPriority(sceneId, selfId, needMoney);
	if not costMoneyRet or costMoneyRet < 0 then
		x300100_NotifyFailTips(sceneId, selfId, "扣除金钱失败。");
		return 0;
	end
	
	local delRet = LuaFnDeletePetByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not delRet or delRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "扣除原始珍兽失败。");
		return 0;
	end
	
	local createRet, PetID_H, PetID_L = LuaFnCreatePetToHuman(sceneId, selfId, petItem.petIds[curPetTakeLevel], 1, petItem.rulerId);
	if not createRet or createRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "增加新珍兽失败。");
		return 0;
	end
	
	-- [ QUFEI 2007-11-21 19:22 UPDATE BugID 28170 ]
	local PlayerName = GetName(sceneId, selfId)				
	local PetName = LuaFnGetPetTransferByGUID( sceneId, selfId, PetID_H, PetID_L )
	-- 发送系统公告
	local strText = ""
	-- zchw
	if (itemTblIndex == 30309186) or (itemTblIndex == 30309187) then --如果是还童丹：鸳鸯
		strText = format("#{HT10}#{_INFOUSR%s}#{HT11}#{_INFOMSG%s}#{HT12}#{_INFOMSG%s}#{HT13}", PlayerName, x300100_g_ItemName, PetName);	
	else
		local inforand = random(3)		
		if inforand == 1 then
			strText = format("#{HT01}#{_INFOMSG%s}#{HT02}#{_INFOMSG%s}#{HT03}#{_INFOUSR%s}#{HT04}", x300100_g_ItemName, PetName, PlayerName )
		elseif inforand == 2 then
			strText = format("#{HT05}#{_INFOUSR%s}#{HT06}#{_INFOMSG%s}#{HT07}#{_INFOMSG%s}#H#{HSLJJF_2}", PlayerName, x300100_g_ItemName, PetName )
		else
			strText = format("#{_INFOUSR%s}#{HT08}#{_INFOMSG%s}#{HT09}#{_INFOMSG%s}#H#{HSLJJF_2}", PlayerName, x300100_g_ItemName, PetName )
		end
	end
	
	
	BroadMsgByChatPipe(sceneId,selfId, strText, 4)				 											
	
	LuaFnSendSpecificImpactToUnit(sceneId, selfId, selfId, selfId, 18, 0);
	return 1
end

--**********************************
--引导心跳处理入口：
--引导技能会在每次心跳结束时调用这个接口。
--返回：1继续下次心跳；0：中断引导。
--注：这里是技能心跳时生效的入口
--**********************************
function x300100_OnActivateEachTick( sceneId, selfId )
	return 1
end

--**********************************
-- 醒目失败提示
--**********************************
function x300100_NotifyFailTips( sceneId, selfId, Tip )
	BeginEvent( sceneId )
		AddText( sceneId, Tip )
	EndEvent( sceneId )
	DispatchMissionTips( sceneId, selfId )
end

--**********************************
-- 检查能否对珍兽进行还童
--**********************************
function x300100_CanOperate(sceneId, selfId)

	local itemTblIndex = LuaFnGetItemIndexOfUsedItem( sceneId, selfId );
	local petItem = x300100_g_itemList[itemTblIndex];
	if not petItem then
		x300100_NotifyFailTips(sceneId, selfId, "未开放道具，无法使用。");
		return 0;
	end

	local petGUID_H = LuaFnGetHighSectionOfTargetPetGuid( sceneId, selfId );
	local petGUID_L = LuaFnGetLowSectionOfTargetPetGuid( sceneId, selfId );
	if not petGUID_H or not petGUID_L then
		x300100_NotifyFailTips(sceneId, selfId, "未到找指定珍兽。");
		return 0;
	end
	
	local curPetTemplateId = LuaFnGetPetDataIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not curPetTemplateId or curPetTemplateId < 0 then
		x300100_NotifyFailTips(sceneId, selfId, "指定珍兽不可用。");
		return 0;
	end
	
	local checkPetRet = LuaFnIsPetAvailableByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not checkPetRet or checkPetRet ~= 1 then
		x300100_NotifyFailTips(sceneId, selfId, "锁定的珍兽不能进行这项操作。");
		return 0;
	end
	
	local spouseGUID_H, spouseGUID_L = LuaFnGetPetSpouseGUIDByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not spouseGUID_H or not spouseGUID_L or spouseGUID_H ~= 0 or spouseGUID_L ~= 0 then
		x300100_NotifyFailTips(sceneId, selfId, "已经有配偶的珍兽不能进行这项操作。");
		return 0;
	end
	
	local petType = LuaFnGetPetTypeByGUID(sceneId, selfId, petGUID_H, petGUID_L);
	if not petType or petType == 1 then
		x300100_NotifyFailTips(sceneId, selfId, "变异和二代珍兽不能进行这项操作。");
		return 0;
	end

	local curPetTakeLevel = GetPetTakeLevel(curPetTemplateId);
	if not curPetTakeLevel or petItem.minPetLevel > curPetTakeLevel or curPetTakeLevel > petItem.maxPetLevel then
		x300100_NotifyFailTips(sceneId, selfId, "只能对携带等级"..petItem.minPetLevel.."到"..petItem.maxPetLevel.."的珍兽进行这项操作。");
		return 0;
	end
	
	if not petItem.petIds[curPetTakeLevel] then
		x300100_NotifyFailTips(sceneId, selfId, "无法对携带等级为"..curPetTakeLevel.."的珍兽进行这项操作。");
		return 0;
	end
	
	local humanMoney = LuaFnGetMoney(sceneId, selfId) +  GetMoneyJZ(sceneId, selfId);   --交子普及 Vega
	local needMoney = LuaFnGetPetHuanTongCost(sceneId, curPetTakeLevel);
	needMoney = needMoney / 100;
	if not humanMoney or not needMoney or needMoney < 0 or humanMoney < 0 or humanMoney < needMoney then
		x300100_NotifyFailTips(sceneId, selfId, "金钱不足。");
		return 0;
	end
	
	return 1
end

